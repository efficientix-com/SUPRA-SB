<?xml version="1.0"?><!DOCTYPE pdf PUBLIC "-//big.faceless.org//report" "report-1.1.dtd">
<pdf>
    <#setting locale = "es_MX">
    <#setting time_zone= "America/Mexico_City">
    <#setting number_format=",##0.00">

    <#assign "dataXML" = "">
    <#if custom?has_content>
        <#if custom.dataXML?has_content>
            <#assign "dataXML" = custom.dataXML>

        </#if>
        <#setting locale=custom.locale>
        <#assign labels = custom.labels>
        <#if custom.certData?has_content>
            <#assign "certData" = custom.certData>
        <#else>
            <#assign "certData" = record>
        </#if>
        <#assign "satCodes" = custom.satcodes>

        <#if custom.multiCurrencyFeature == "true">
            <#assign "currencyCode" = record.currencysymbol>
            <#assign exchangeRate = record.exchangerate?string.number>
        <#else>
            <#assign "currencyCode" = "MXN">
            <#assign exchangeRate = 1>
        </#if>
        <#if custom.oneWorldFeature == "true">
            <#assign customCompanyInfo = record.subsidiary>
        <#else>
            <#assign "customCompanyInfo" = companyInformation>
        </#if>
        <#if customer.isperson == "T">
            <#assign customerName = customer.firstname + ' ' + customer.lastname>
        <#else>
            <#assign "customerName" = customer.companyname>
        </#if>
        <#assign "summary" = custom.summary>
        <#assign "totalAmount" = summary.subtotal - summary.totalDiscount>
        <#assign "companyTaxRegNumber" = custom.companyInfo.rfc>
        <#assign currencySymbolMap = {"USD":"$","CAD":"$","EUR":"€","AED":"د.إ.‏","AFN":"؋","ALL":"Lek","AMD":"դր.","ARS":"$","AUD":"$","AZN":"ман.","BAM":"KM","BDT":"৳","BGN":"лв.","BHD":"د.ب.‏","BIF":"FBu","BND":"$","BOB":"Bs","BRL":"R$","BWP":"P","BYR":"BYR","BZD":"$","CDF":"FrCD","CHF":"CHF","CLP":"$","CNY":"CN¥","COP":"$","CRC":"₡","CVE":"CV$","CZK":"Kč","DJF":"Fdj","DKK":"kr","DOP":"RD$","DZD":"د.ج.‏","EEK":"kr","EGP":"ج.م.‏","ERN":"Nfk","ETB":"Br","GBP":"£","GEL":"GEL","GHS":"GH₵","GNF":"FG","GTQ":"Q","HKD":"$","HNL":"L","HRK":"kn","HUF":"Ft","IDR":"Rp","ILS":"₪","INR":"টকা","IQD":"د.ع.‏","IRR":"﷼","ISK":"kr","JMD":"$","JOD":"د.أ.‏","JPY":"￥","KES":"Ksh","KHR":"៛","KMF":"FC","KRW":"₩","KWD":"د.ك.‏","KZT":"тңг.","LBP":"ل.ل.‏","LKR":"SL Re","LTL":"Lt","LVL":"Ls","LYD":"د.ل.‏","MAD":"د.م.‏","MDL":"MDL","MGA":"MGA","MKD":"MKD","MMK":"K","MOP":"MOP$","MUR":"MURs","MXN":"$","MYR":"RM","MZN":"MTn","NAD":"N$","NGN":"₦","NIO":"C$","NOK":"kr","NPR":"नेरू","NZD":"$","OMR":"ر.ع.‏","PAB":"B/.","PEN":"S/.","PHP":"₱","PKR":"₨","PLN":"zł","PYG":"₲","QAR":"ر.ق.‏","RON":"RON","RSD":"дин.","RUB":"руб.","RWF":"FR","SAR":"ر.س.‏","SDG":"SDG","SEK":"kr","SGD":"$","SOS":"Ssh","SYP":"ل.س.‏","THB":"฿","TND":"د.ت.‏","TOP":"T$","TRY":"TL","TTD":"$","TWD":"NT$","TZS":"TSh","UAH":"₴","UGX":"USh","UYU":"$","UZS":"UZS","VEF":"Bs.F.","VND":"₫","XAF":"FCFA","XOF":"CFA","YER":"ر.ي.‏","ZAR":"R","ZMK":"ZK"}>
        <#function fmtc value>
            <#assign dst =  currencySymbolMap[currencyCode] + value?number?string[",##0.00"]>
            <#return dst>
        </#function>
    <#else>
        <#assign "certData" = record>
    </#if>


    <#assign infoEmpresa = record.subsidiary>


    <head>
        <#assign "shipmentcost" = 0>
        <link name="NotoSans" type="font" subtype="truetype" src="${nsfont.NotoSans_Regular}"
              src-bold="${nsfont.NotoSans_Bold}" src-italic="${nsfont.NotoSans_Italic}"
              src-bolditalic="${nsfont.NotoSans_BoldItalic}" bytes="2"/>
        <#if .locale == "zh_CN">
            <link name="NotoSansCJKsc" type="font" subtype="opentype" src="${nsfont.NotoSansCJKsc_Regular}"
                  src-bold="${nsfont.NotoSansCJKsc_Bold}" bytes="2"/>
        <#elseif .locale == "zh_TW">
            <link name="NotoSansCJKtc" type="font" subtype="opentype" src="${nsfont.NotoSansCJKtc_Regular}"
                  src-bold="${nsfont.NotoSansCJKtc_Bold}" bytes="2"/>
        <#elseif .locale == "ja_JP">
            <link name="NotoSansCJKjp" type="font" subtype="opentype" src="${nsfont.NotoSansCJKjp_Regular}"
                  src-bold="${nsfont.NotoSansCJKjp_Bold}" bytes="2"/>
        <#elseif .locale == "ko_KR">
            <link name="NotoSansCJKkr" type="font" subtype="opentype" src="${nsfont.NotoSansCJKkr_Regular}"
                  src-bold="${nsfont.NotoSansCJKkr_Bold}" bytes="2"/>
        <#elseif .locale == "th_TH">
            <link name="NotoSansThai" type="font" subtype="opentype" src="${nsfont.NotoSansThai_Regular}"
                  src-bold="${nsfont.NotoSansThai_Bold}" bytes="2"/>
        </#if>
        <macrolist>
            <macro id="nlheader">
                <table class="header" height="110px" style="width: 100%;">
                    <tr height="110px">
                        <#--  Logo  -->
                        <td colspan="4" height="110px">
                            <#if certData?has_content>
                                <#if record.custbody_efx_fe_info_location_pdf == true>
                                    <#if record.custbody_efx_fe_logoloc?has_content>
                                            <#assign "urldir" = "https://system.netsuite.com"+record.custbody_efx_fe_logoloc>
                                            <img width="140" height="70" src="${urldir}"/>
                                        <#else>
                                            <#assign "urldir" = "https://system.netsuite.com"+record.custbody_efx_fe_logosub>
                                            <img width="140" height="70" src="${urldir}"/>
                                    </#if>
                                <#else>
                                    <#if record.custbody_efx_fe_logosub?has_content>
                                        <#assign "urldir" = "https://system.netsuite.com"+record.custbody_efx_fe_logosub>
                                        <img width="140" height="70" src="${urldir}"/>
                                    </#if>
                                </#if>

                            <#else>
                                <#if record.custbody_efx_fe_info_location_pdf == true>
                                    <#if record.custbody_efx_fe_logoloc?has_content>
                                        <#assign "urldir" = "https://system.netsuite.com"+record.custbody_efx_fe_logoloc>
                                        <img width="140" height="70" src="${urldir}"/>
                                    <#else>
                                        <#if record.custbody_efx_fe_logosub?has_content>
                                            <#assign "urldir" = "https://system.netsuite.com"+record.custbody_efx_fe_logosub>
                                            <img width="140" height="70" src="${urldir}"/>

                                        </#if>
                                    </#if>
                                <#else>
                                    <#if record.custbody_efx_fe_logosub?has_content>
                                        <#assign "urldir" = "https://system.netsuite.com"+record.custbody_efx_fe_logosub>
                                        <img width="140" height="70" src="${urldir}"/>
                                    <#else>
                                        <#if infoEmpresa.logo@url?length != 0>
                                            <span><img width="140" height="70" src="${infoEmpresa.logo@url}"/></span>
                                        <#elseif companyInformation.logoUrl?length != 0>
                                            <img width="140" height="70" src="${companyInformation.logoUrl}"/>
                                        </#if>
                                    </#if>
                                </#if>
                            </#if>

                        </td>

                        <#--  Direccion de empresa  -->
                        <td colspan="7" align="center" style="font-size: 8px;">

                            <#if record.custbody_efx_fe_gbl_diremisor?has_content>
                                    ${record.custbody_efx_fe_gbl_diremisor}
                            <#else>
                                <#if record.custbody_efx_fe_info_location_pdf == true>
                                    <table style="width: 100%;">
                                        <tr>
                                            <td style="font-size: 10px;" align="center">
                                                SUPRA DESARROLLOS TECNOLOGICOS S.A de C.V
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-size: 8px; " align="left">
                                                <strong>RFC: </strong> <#outputformat "XML">${record.custbody_efx_fe_dirloc?keep_after_last("<br />")}</#outputformat><br /><br />
                                                <strong>Regimen fiscal: </strong> ${record.subsidiary.custrecord_mx_sat_industry_type}<br /><br />
                                                <strong>Domicilio fiscal: </strong> ${record.custbody_efx_fe_dirloc?keep_before_last("<br />")}<br /><br />
                                            </td>
                                        </tr>
                                    </table>

                                <#else>
                                <table style="width: 100%;">
                                        <tr>
                                            <td style="font-size: 10px;" align="center">
                                                SUPRA DESARROLLOS TECNOLOGICOS S.A de C.V
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="font-size: 8px; " align="left">
                                                <strong>RFC: </strong> <#outputformat "XML">${record.custbody_efx_fe_dirsubs?keep_after_last("<br />")}</#outputformat><br /><br />
                                                <strong>Regimen fiscal: </strong> ${record.subsidiary.custrecord_mx_sat_industry_type}<br /><br />
                                                <strong>Domicilio fiscal: </strong> ${record.custbody_efx_fe_dirsubs?keep_before_last("<br />")}<br /><br />
                                            </td>
                                        </tr>
                                    </table>

                                </#if>
                            </#if>

                        </td>
                        <#--  tabla de datos custom  -->
                        <td colspan="4" style="font-size: 10px;" align="right">
                            <table style="width: 100%; border: 1px solid black;">

                                <tr>
                                    <td colspan="10" style="font-size:9px; padding: 4px;"><strong>Comprobante fiscal digital: </strong>(P)Pago</td>
                                </tr>

                                <tr>
                                    <td colspan="10" style="font-size:9px; padding: 4px;"><strong>Serie: </strong><#if dataXML?has_content>${dataXML.atributos.Serie}</#if></td>
                                </tr>

                                <tr>
                                    <td colspan="10" style="font-size:9px; padding: 4px;"><strong>Folio: </strong><#if dataXML?has_content>${dataXML.atributos.Folio}</#if></td>
                                </tr>

                                <tr>
                                    <td colspan="10" style="font-size:9px; padding: 4px;"><strong>Fecha: </strong><#if dataXML?has_content>${dataXML.atributos.Fecha}<#else>${record.custbody_mx_cfdi_certify_timestamp}</#if></td>
                                </tr>

                            </table>

                        </td>
                    </tr>
                    <tr>
                        <#if record.custbody_efx_fe_info_location_pdf == true>
                            <td colspan="6" style="font-size:9px;"><strong>Expedido en: </strong> ${record.custbody_efx_fe_dirloc?keep_before_last("<br />")}<br /><br /></td>
                        <#else>
                            <td colspan="6" style="font-size:9px;"><strong>Expedido en: </strong> ${record.custbody_efx_fe_dirsubs?keep_before_last("<br />")}<br /><br /></td>
                        </#if>
                    </tr>
                    <tr style="border-bottom: 1px solid black;">
                        <td colspan="6" style="font-size:9px; "><strong>Lugar de Expedición: </strong><#if dataXML?has_content>${dataXML.atributos.LugarExpedicion}<#else>${record.custbody_efx_fe_lugar_expedicion}</#if></td>
                    </tr>
                </table>
            </macro>

        </macrolist>
        <style type="text/css">
            * {
                <#if .locale == "zh_CN"> font-family: NotoSans, NotoSansCJKsc, sans-serif;
                <#elseif .locale == "zh_TW"> font-family: NotoSans, NotoSansCJKtc, sans-serif;
                <#elseif .locale == "ja_JP"> font-family: NotoSans, NotoSansCJKjp, sans-serif;
                <#elseif .locale == "ko_KR"> font-family: NotoSans, NotoSansCJKkr, sans-serif;
                <#elseif .locale == "th_TH"> font-family: NotoSans, NotoSansThai, sans-serif;
                <#else> font-family: NotoSans, sans-serif;
                </#if>
                }

                table {
                    font-size: 9pt;
                    table-layout: fixed;
                }

                th {
                    font-weight: bold;
                    font-size: 8pt;
                    vertical-align: middle;
                    /*padding: 5px 6px 3px;
                    background-color: #e3e3e3;
                    color: #161616;*/
                }

                table.tablascompletas {
                    width: 100%;
                    margin-top: 10px;
                    border: 1px;
                    border-color: #e3e3e3
                }

                td.cuerposnoarticulos {
                    padding: 2px;
                    font-size: 7pt;
                }

                td.cabecera, th.cabecera {
                    color: #000000;
                    font-size: 8pt;
                    background-color: #e3e3e3;
                    padding: 2px;
                }

                td {
                    padding: 4px 6px;
                }

                td p {
                    align: left
                }

                b {
                    font-weight: bold;
                    color: #000000;
                }

                table.header td {
                    padding: 0px;
                    font-size: 10pt;
                }

                table.footer td {
                    padding: 0px;
                    font-size: 8pt;
                }

                table.itemtable th {
                    padding-bottom: 10px;
                    padding-top: 10px;

                }

                table.testing *{
                    /* TESTING */
                    border: 1px solid red;
                }

                table.desglose td {
                    font-size: 4pt;
                    padding-top: 0px;
                    padding-bottom: 0px;
                }

                table.body td {
                    padding-top: 2px;
                }

                table.total {
                    page-break-inside: avoid;
                }

                tr.totalrow {
                    background-color: #e3e3e3;
                    line-height: 200%;
                }

                td.totalboxtop {
                    font-size: 12pt;
                    background-color: #e3e3e3;
                }

                td.addressheader {
                    font-size: 8pt;
                    padding-top: 6px;
                    padding-bottom: 2px;
                }

                td.subtotal {
                    text-align: right;
                }

                td.address {
                    padding-top: 0px;
                }

                td.totalboxmid {
                    font-size: 28pt;
                    padding-top: 20px;
                    background-color: #e3e3e3;
                }

                td.totalboxbot {
                    background-color: #e3e3e3;
                    font-weight: bold;
                }

                span.title {
                    font-size: 28pt;
                }

                span.number {
                    font-size: 16pt;
                }

                span.itemname {
                    font-weight: bold;
                    line-height: 150%;
                }

                hr {
                    width: 100%;
                    color: #ffffff;
                    background-color: #e3e3e3;
                    height: 1px;
                }
        </style>
    </head>
    <body header="nlheader" header-height="15%" footer="nlfooter" footer-height="20pt"  size="Letter">

        <#assign "desglosa_cliente" = record.entity.custentity_efx_cmp_registra_ieps>
        <#assign "tipoGBL" = record.custbody_efx_fe_gbl_type>

        <#assign "desglose_json_body" = record.custbody_efx_fe_tax_json>
        <#if desglose_json_body?has_content>
            <#assign "desglose_body" = desglose_json_body?eval>
            <#assign "desglose_ieps" = desglose_body.rates_ieps>
            <#assign "desglose_iva" = desglose_body.rates_iva>
            <#assign "ieps_total" = desglose_body.ieps_total>
            <#assign "iva_total" = desglose_body.iva_total>
            <#assign "local_total" = desglose_body.local_total>
            <#assign "desglose_ret" = desglose_body.rates_retencion>
            <#assign "desglose_loc" = desglose_body.rates_local>
            <#assign "desglose_total_discount" = desglose_body.descuentoSinImpuesto>
            <#assign "cabecera_total" = desglose_body.total>
            <#assign "cabecera_subtotal" = desglose_body.subtotal>
            <#else>
                <#assign "desglose_body" = {}>
                <#assign "desglose_ieps" = 0>
                <#assign "desglose_iva" = 0>
                <#assign "ieps_total" = 0>
                <#assign "iva_total" = 0>
                <#assign "local_total" = 0>
                <#assign "desglose_ret" = 0>
                <#assign "desglose_loc" = 0>
                <#assign "desglose_total_discount" = 0>
                <#assign "cabecera_total" = 0>
                <#assign "cabecera_subtotal" = 0>
        </#if>


        <#assign "obj_totales_imp"= {}>
        <#assign totaliepsGBL = 0/>
        <#assign totalivaGBL = 0/>
        <#assign totalretGBL = 0/>
        <#assign totallocGBL = 0/>
        <#assign totalivaimp = 0/>
        <#assign totaldiscount = 0/>
        <#assign totaliepsimp = 0/>

        <#if dataXML?has_content>
            <table style="width: 100%; margin-top: 20px; border-bottom: 1px solid black">
                <tr>
                    <td class="body" colspan="7" style="font-size:9px;">
                        <table style="width: 100%; margin-top: 5px;">
                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Concepto: </b> ${dataXML.Complemento.Pagos.Pago.atributos.FormaDePagoP}
                                </td>
                            </tr>

                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Documento: </b> Num de referencia bancaria
                                </td>
                            </tr>

                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Fecha aplicación: </b> ${record.custbody_efx_fe_fechadepago}
                                </td>
                            </tr>
                        </table>
                    </td>

                    <td class="body" colspan="7" style="font-size:9px;">
                        <table style="width: 100%; margin-top: 5px;">
                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Importe: </b> ${record.applied}
                                </td>
                            </tr>

                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Moneda: </b> ${record.currencysymbol}
                                </td>
                            </tr>

                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Tipo de cambio: </b> ${record.exchangerate}
                                </td>
                            </tr>
                        </table>
                    </td>

                </tr>

            </table>
        <#else>
            <table style="width: 100%; margin-top: 20px; border-bottom: 1px solid black">
                <tr>
                    <td class="body" colspan="7" style="font-size:9px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Concepto:</b><br />
                                    <#if record.entity.custentity_mx_sat_registered_name?has_content>
                                        ${record.entity.custentity_mx_sat_registered_name}
                                    <#else>
                                        ${record.entityname}
                                    </#if>
                                </td>
                            </tr>

                            <tr>
                                <td style="font-size:9px;" align="left">
                                    ${record.billaddress?keep_after(" />")?upper_case}
                                </td>
                            </tr>
                        </table>
                    </td>

                    <td class="body" colspan="7" style="font-size:9px;" align="right">
                        <table style="width: 100%;">
                            <tr>
                                <td style="font-size:9px;" align="right">
                                    <b>Registro de identificación fiscal:</b><br />
                                </td>
                            </tr>

                            <tr>
                                <td style="font-size:9px;" align="right">
                                    <b>Residencia: </b> (${record.billcountry}) ${record.billstate}
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>

                <tr>
                    <td class="body" colspan="7" style="font-size:9px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Orden de Venta: </b> ${record.createdfrom}
                                </td>
                            </tr>

                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Vendedor: </b> ${record.salesrep}
                                </td>
                            </tr>

                            <tr>
                                <td style="font-size:9px;" align="left">
                                    <b>Enviar a: </b> ${record.shipaddress}
                                </td>
                            </tr>
                        </table>
                    </td>

                    <td class="body" colspan="7" style="font-size:9px;" align="right">
                        <table style="width: 100%;">
                            <tr>
                                <td style="font-size:9px;" align="right">
                                    <b>Pedido: </b> ${record.otherrefnum}

                                </td>
                            </tr>

                            <tr>
                                <td style="font-size:9px;" align="right">
                                    <b>No. de Proveedor: </b>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </#if>

        <#assign "line_discount"= 0>
        <#assign "importe_discount" = []>
        <#list record.item as item>
            <#assign "tipo_articulo" = item.item?keep_before(" ")>
            <#if tipo_articulo == "Descuento">
                <#assign "importe_discount" = importe_discount+ [item.grossamt]>
            <#else>
                <#assign "importe_discount" = importe_discount + [0]>
            </#if>
        </#list>
        <#assign "importe_discount" = importe_discount+ [0]>
        <#assign "descuento_total" = 0>


        <#if dataXML?has_content>
            <table style="width: 100%; margin-top: 3px;">
                <#if dataXML.Conceptos.Concepto?is_sequence>
                    <thead>
                        <tr style=" border-bottom: 1px solid black; margin-top: 0px; padding-top: 0px; padding-bottom: 3px;">
                            <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Cantidad</th>
                            <th align="center" colspan="2" style="font-size: 4pt; padding-left: 0px; padding-right: 0px;">UM</th>
                            <th align="center" colspan="3" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Clave SAT</th>
                            <th align="center" colspan="10" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Descripcion</th>
                            <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Valor Unitario</th>
                            <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Importe</th>
                        </tr>
                    </thead>
                    <#assign base_line_calc = 0>
                    <#assign "name_items" = []>
                    <#assign "units_items" = []>
                    <#list record.item as item>
                        <#assign "tipo_articulo" = item.itemtype>
                        <#if tipo_articulo != "Descuento">
                            <#assign "name_items" = name_items + [item.item]>
                            <#assign "units_items" = units_items + [item.units]>
                        </#if>
                    </#list>

                    <#assign array_position = 0>
                    <#list dataXML.Conceptos.Concepto as Conceptos>
                        <tr>
                            <td align="center" colspan="4" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.Cantidad?number?string[",##0.00"]}</td>
                            <td align="center" colspan="2" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.ClaveUnidad}</td>
                            <td align="center" colspan="3" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.ClaveProdServ}</td>
                            <td align="center" colspan="10" style="font-size: 5pt; padding-top: 4px;">${Conceptos.atributos.Descripcion}</td>
                            <td align="center" colspan="4" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.ValorUnitario?number?string[",##0.00"]}</td>
                            <td align="center" colspan="4" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">${Conceptos.atributos.Importe?number?string[",##0.00"]}</td>
                        </tr>
                        <#if Conceptos.Impuestos.Traslados.Traslado?has_content>
                            <#if Conceptos.Impuestos.Traslados.Traslado?is_sequence>
                                <#list Conceptos.Impuestos.Traslados.Traslado as impuestos_linec>
                                    <#assign base_line_calc = base_line_calc + impuestos_linec.atributos.Base?number>
                                </#list>
                            <#else>
                                <#assign base_line_calc = impuestos_line_calc + Conceptos.Impuestos.Traslados.Traslado.atributos.Base?number>
                            </#if>
                        </#if>
                        <#assign array_position = array_position + 1>
                    </#list>
                    <tr>
                        <td class="body" colspan="46" style="font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">
                            <table  style="width: 100%;" >
                                <tr style=" border-bottom: 1px solid black;">
                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <b>Documento</b>
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <b>Fecha</b>
                                    </td>

                                    <td colspan="10" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <b>UUID</b>
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <b>Mon.</b>
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <b>Met.Pago</b>
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <b>Saldo Anterior</b>
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <b>Importe pagado</b>
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <b>Saldo Insoluto</b>
                                    </td>


                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <b>Parc.</b>
                                    </td>
                                </tr>

                                <tr style=" border-bottom: 1px solid black;">
                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        ${dataXML.atributos.Serie}${dataXML.atributos.Folio}
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        ${dataXML.atributos.Fecha}
                                    </td>

                                    <td colspan="10" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        <#if certData?has_content>
                                            ${certData.custbody_mx_cfdi_uuid}
                                        </#if>
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        ${dataXML.atributos.Moneda}
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        ${dataXML.Complemento.Pagos.Pago.DoctoRelacionado.atributos.MetodoDePagoDR}
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        ${dataXML.Complemento.Pagos.Pago.DoctoRelacionado.atributos.ImpSaldoAnt}
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        ${dataXML.Complemento.Pagos.Pago.DoctoRelacionado.atributos.ImpPagado}
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        ${dataXML.Complemento.Pagos.Pago.DoctoRelacionado.atributos.ImpSaldoInsoluto}
                                    </td>

                                    <td colspan="2" style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                        ${dataXML.Complemento.Pagos.Pago.DoctoRelacionado.atributos.NumParcialidad}
                                    </td>

                                </tr>
                            </table>
                        </td>
                    </tr>
                </#if>
            </table>
        <#else>
            <table  style="width: 100%; margin-top: 3px;">
                <#list record.item as item>
                    <#if item_index==0>
                        <thead>
                            <tr style=" border-bottom: 1px solid black; margin-top: 0px; padding-top: 0px; padding-bottom: 3px;">
                                <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Cantidad</th>
                                <th align="center" colspan="2" style="font-size: 4pt; padding-left: 0px; padding-right: 0px;">UM</th>
                                <th align="center" colspan="3" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Clave SAT</th>
                                <th align="center" colspan="10" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Descripcion</th>
                                <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Valor Unitario</th>
                                <th align="center" colspan="4" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">${item.amount@label}</th>
                            </tr>
                        </thead>
                    </#if>

                    <#assign "tipo_articulo" = item.item?keep_before(" ")>
                    <#if item.quantity?has_content==false>
                        <#assign "line_discount" = line_discount + 1>
                    </#if>
                    <#if item.quantity?has_content>
                        <tr>
                            <#assign "desglose_json" = item.custcol_efx_fe_tax_json>
                            <#if desglose_json?has_content>
                                <#assign "desglose" = desglose_json?eval>
                                <td align="center" colspan="4" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">${item.quantity}</td>
                                <td align="center" colspan="2" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">###</td>
                                <td align="center" colspan="3" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">${item.custcol_mx_txn_line_sat_item_code?keep_before(" ")}</td>
                                <td align="center" colspan="10" style="font-size: 5pt; padding-top: 4px;">${item.description}</td>
                                <td align="center" colspan="4" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">${item.rate?string[",##0.00"]}</td>
                                <td align="center" colspan="4" style="font-size: 5pt; padding-top: 4px; padding-left: 0px; padding-right: 0px;">${item.amount}</td>
                                <#assign "descuento_total" = descuento_total + importe_discount[item_index+1]>
                            </#if>
                        </tr>
                    </#if>
                </#list>
                <#assign json = record.custbody_efx_fe_tax_json>
                <#if json?has_content>
                    <#assign taxObj = json?eval>
                </#if>

                <tr>
                    <td class="body" colspan="46" style="font-size: 5pt; padding-top: 1px; padding-left: 0px; padding-right: 0px;">
                        <table  style="width: 100%;" >
                            <tr style=" border-bottom: 1px solid black;">
                                <td style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                    <b>Documento</b>
                                </td>

                                <td style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                    <b>Fecha</b>
                                </td>

                                <td style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                    <b>UUID</b>
                                </td>

                                <td style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                    <b>Mon.</b>
                                </td>

                                <td style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                    <b>Met.Pago</b>
                                </td>

                                <td style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                    <b>Saldo Anterior</b>
                                </td>

                                <td style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                    <b>Importe pagado</b>
                                </td>

                                <td style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                    <b>Saldo Insoluto</b>
                                </td>


                                <td style="font-size: 5pt; padding-top: 3px; padding-left: 14px; padding-right: 0px;">
                                    <b>Parc.</b>
                                </td>
                            </tr>

                            <tr style=" border-bottom: 1px solid black;">
                                <td>
                                    ${dataXML.atributos.Serie}${dataXML.atributos.Folio}
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </#if>

        <#if record.custbody_efx_fe_detalle_imp_loc?has_content>
            <#assign listaLocales = record.custbody_efx_fe_detalle_imp_loc?eval>
            <table class="itemtable" style="width: 100%; margin-top: 3px; border: 1px; border-color: #e3e3e3;">
                <thead>
                <tr style="margin-top: 0px; padding-top: 0px; padding-bottom: 0px">
                    <th align="center" colspan="2" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Impuesto Local</th>
                    <th align="center" colspan="2" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Tasa</th>
                    <th align="center" colspan="2" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Porcentaje</th>
                    <th align="center" colspan="2" style="font-size: 5pt; padding-left: 0px; padding-right: 0px;">Importe</th>
                </tr>
                </thead>
                <#list listaLocales as listadoLocales>
                    <tr>
                        <td align="center" colspan="2" line-height="150%" style="border-left: 0px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px;">${listadoLocales.impLocRetenido}</td>
                        <td align="center" colspan="2" line-height="150%" style="border-left: 0px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px;">${listadoLocales.tasadeRetencion}</td>
                        <td align="center" colspan="2" line-height="150%" style="border-left: 0px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px;">${listadoLocales.porcentaje}</td>
                        <td align="center" colspan="2" line-height="150%" style="border-left: 0px; border-color: #e3e3e3;font-size: 5pt; padding-top: 1px;">${listadoLocales.importe}</td>
                    </tr>
                </#list>
            </table>
        </#if>

        <#assign "desglose_json_body" = record.custbody_efx_fe_tax_json>
        <#if desglose_json_body?has_content>
            <#assign "desglose_body" = desglose_json_body?eval>
            <#assign "desglose_ieps" = desglose_body.rates_ieps>
            <#assign "desglose_iva" = desglose_body.rates_iva>
            <#assign "desglose_ret" = desglose_body.rates_retencion>
            <#assign "retencion_total" = desglose_body.retencion_total?number?string[",##0.00"]>
            <#assign "desglose_loc" = retencion_total>
        <#else>
            <#assign "desglose_ieps" = 0>
            <#assign "desglose_iva" = 0>
            <#assign "desglose_ret" = 0>
            <#assign "desglose_loc" = 0>
            <#assign "retencion_total" = 0>
        </#if>


        <table  style="width: 100%; margin-top: 5px; padding: 0px;">
            <tr style="border-bottom: 1px solid black">
                <td colspan="6" style="margin: 0px; padding: 0px;">
                    <table class="total" style="width: 100%; margin-top: 0px; border: 0px; border-color: #e3e3e3;">
                        <tr>
                            <#assign qrcodeImage = "data:image/png;base64, " + certData.custbody_mx_cfdi_qr_code >
                            <td align="left" colspan="2">
                                <#if certData?has_content>
                                    <img style="width: 70px;height:70px" src="${qrcodeImage}"/>
                                </#if>
                            </td>
                            <td align="left" colspan="10" style="font-size: 7px;">
                                <b>"ESTE DOCUMENTO ES UNA REPRESENTACIÓN IMPRESA DE UN CFDI"</b><br />
                                <br />
                                <b>Folio fiscal: </b> ${certData.custbody_mx_cfdi_uuid}<br />
                                <br />
                                <b>Fecha y hora de certificación: </b> ${dataXML.atributos.Fecha}
                                <b>Sello digital del CFDI: </b> ${certData.custbody_mx_cfdi_signature}
                            </td>
                        </tr>
                    </table>
                </td>
                <td colspan="2" style="margin: 0px; padding: 0;">
                    <table style="width: 100%; margin-top: 0px; margin-left: 0px">
                        <tr>
                            <td colspan="1" style="font-size: 7pt;"><b>Subtotal</b></td>
                            <#if dataXML?has_content>
                                <td align="right" colspan="1" style="font-size: 7pt;">${dataXML.atributos.SubTotal?number?string[",##0.00"]}</td>
                            <#else>
                                <#if record.custbody_efx_fe_gbl_subtotal?has_content>
                                    <td align="right" colspan="1"
                                        style="font-size: 7pt;">${record.custbody_efx_fe_gbl_subtotal?number?string[",##0.00"]}</td>
                                <#else>
                                    <td align="right" colspan="1"
                                        style="font-size: 7pt;">${record.subtotal?string[",##0.00"]}</td>
                                </#if>
                            </#if>
                        </tr>
                        <tr>
                            <td colspan="1" style="font-size: 7pt;"><b>Total</b>
                            </td>
                            <#if dataXML?has_content>
                                <td align="right" colspan="1" style="font-size: 7pt;">${dataXML.atributos.Total?number?string[",##0.00"]}</td>
                            <#else>
                                <td align="right" colspan="1"
                                    style="font-size: 7pt;"><#if cabecera_total?has_content>${cabecera_total?number?string[",##0.00"]}</#if></td>
                            </#if>

                        </tr>
                    </table>
                </td>
            </tr>
        </table>

            <table style="width: 100%; margin-top: 10px; padding: 0;">
                <#if certData?has_content>
                    <tr>
                        <td colspan="4" style="font-size: 7pt"><b>Número de serie del Certificado de Sello Digital:</b><br />
                            <br />
                            ${certData.custbody_mx_cfdi_issuer_serial}
                        </td>

                        <td colspan="3" style="font-size: 7pt"><b>Número de serie del Certificado de Sello Digital del SAT:</b><br />
                            <br />
                            ${certData.custbody_mx_cfdi_sat_serial}
                        </td>
                    </tr>

                    <tr>
                        <td colspan="7" style="font-size: 7pt"><b>Cadena original del complemento de certificación digital del SAT:</b> <span style="font-size: 4pt">${certData.custbody_mx_cfdi_cadena_original}</span></td>
                    </tr>

                    <tr>
                        <td colspan="7" style="font-size: 7pt"><b>Sello digital del SAT:</b> <span style="font-size: 4pt">${certData.custbody_mx_cfdi_sat_signature}</span></td>
                    </tr>
                </#if>
            </table>

    </body>
</pdf>